import{b as re,V as ie}from"./VInput-18f5ff20.js";import{m as ce}from"./VSelect-8ac6da1d.js";import{f as ve}from"./forwardRefs-a29b5f65.js";import{m as de,u as fe}from"./filter-da4abc64.js";import{m as me}from"./transition-27cd020f.js";import{u as pe,V as he,a as U}from"./VList-6ff14ab1.js";import{ar as ge,aF as ye,au as ke,k as _,at as B,I as y,aD as Ve,aM as Ce,z,bb as O,aw as _e,p as s,F as J,$ as I,ax as be,D as we,d as xe,aA as K,o as j,c as Ae,q as F,b as Ie,C as Se,ab as Pe,a as De,w as Fe,n as Re,ac as q,ad as H,s as Te}from"./index-8abefeb0.js";import{m as Me,V as G}from"./VTextField-c12e6cf7.js";import{V as Le}from"./VMenu-c1c5f8c8.js";import{V as $e}from"./VCheckboxBtn-4b1fa09e.js";import{V as Ee}from"./VChip-9bbbdea6.js";function Be(e,i,t){if(i==null)return e;if(Array.isArray(i))throw new Error("Multiple matches is not implemented");return typeof i=="number"&&~i?s(J,null,[s("span",{class:"v-autocomplete__unmask"},[e.substr(0,i)]),s("span",{class:"v-autocomplete__mask"},[e.substr(i,t)]),s("span",{class:"v-autocomplete__unmask"},[e.substr(i+t)])]):e}const Ne=ge()({name:"VAutocomplete",props:{search:String,...de({filterKeys:["title"]}),...ce(),...ye(Me({modelValue:null}),["validationValue","dirty","appendInnerIcon"]),...me({transition:!1})},emits:{"update:focused":e=>!0,"update:search":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(e,i){let{slots:t}=i;const{t:h}=ke(),v=_(),k=_(!1),d=_(!0),S=_(),R=B(e,"menu"),f=y({get:()=>R.value,set:l=>{var a;R.value&&!l&&((a=S.value)!=null&&a.Î¨openChildren)||(R.value=l)}}),o=_(-1),Q=y(()=>{var l;return(l=v.value)==null?void 0:l.color}),{items:T,transformIn:W,transformOut:X}=pe(e),{textColorClasses:Y,textColorStyles:Z}=Ve(Q),r=B(e,"search",""),g=B(e,"modelValue",[],l=>W(Ce(l)),l=>{const a=X(l);return e.multiple?a:a[0]??null}),b=re(),{filteredItems:M,getMatches:ee}=fe(e,T,y(()=>d.value?void 0:r.value)),V=y(()=>g.value.map(l=>T.value.find(a=>e.valueComparator(a.value,l.value))||l)),L=y(()=>e.hideSelected?M.value.filter(l=>!V.value.some(a=>a.value===l.value)):M.value),$=y(()=>V.value.map(l=>l.props.value)),N=y(()=>V.value[o.value]),E=_();function le(l){e.openOnClear&&(f.value=!0),r.value=""}function te(){e.hideNoData&&!T.value.length||e.readonly||b!=null&&b.isReadonly.value||(f.value=!0)}function ae(l){var P,n,m,C;if(e.readonly||b!=null&&b.isReadonly.value)return;const a=v.value.selectionStart,c=$.value.length;if((o.value>-1||["Enter","ArrowDown","ArrowUp"].includes(l.key))&&l.preventDefault(),["Enter","ArrowDown"].includes(l.key)&&(f.value=!0),["Escape"].includes(l.key)&&(f.value=!1),["Enter","Escape","Tab"].includes(l.key)&&(d.value=!0),l.key==="ArrowDown"?(P=E.value)==null||P.focus("next"):l.key==="ArrowUp"&&((n=E.value)==null||n.focus("prev")),!!e.multiple){if(["Backspace","Delete"].includes(l.key)){if(o.value<0){l.key==="Backspace"&&!r.value&&(o.value=c-1);return}const u=o.value;N.value&&x(N.value),o.value=u>=c-1?c-2:u}if(l.key==="ArrowLeft"){if(o.value<0&&a>0)return;const u=o.value>-1?o.value-1:c-1;V.value[u]?o.value=u:(o.value=-1,v.value.setSelectionRange((m=r.value)==null?void 0:m.length,(C=r.value)==null?void 0:C.length))}if(l.key==="ArrowRight"){if(o.value<0)return;const u=o.value+1;V.value[u]?o.value=u:(o.value=-1,v.value.setSelectionRange(0,0))}}}function ne(l){r.value=l.target.value}function ue(){k.value&&(d.value=!0)}function oe(l){k.value=!0}function se(l){var a;l.relatedTarget==null&&((a=v.value)==null||a.focus())}const w=_(!1);function x(l){if(e.multiple){const a=$.value.findIndex(c=>e.valueComparator(c,l.value));if(a===-1)g.value=[...g.value,l];else{const c=[...g.value];c.splice(a,1),g.value=c}}else g.value=[l],w.value=!0,t.selection||(r.value=l.title),f.value=!1,d.value=!0,O(()=>w.value=!1)}return z(k,l=>{var a;l?(w.value=!0,r.value=e.multiple||t.selection?"":String(((a=V.value.at(-1))==null?void 0:a.props.title)??""),d.value=!0,O(()=>w.value=!1)):(f.value=!1,r.value="")}),z(r,l=>{!k.value||w.value||(l&&(f.value=!0),d.value=!l)}),_e(()=>{const l=!!(e.chips||t.chip),a=!!(!e.hideNoData||L.value.length||t.prepend||t.append||t["no-data"]),c=g.value.length>0,[P]=G.filterProps(e);return s(G,I({ref:v},P,{modelValue:r.value,"onUpdate:modelValue":n=>{n==null&&(g.value=[])},focused:k.value,"onUpdate:focused":n=>k.value=n,validationValue:g.externalValue,dirty:c,onInput:ne,class:["v-autocomplete",{"v-autocomplete--active-menu":f.value,"v-autocomplete--chips":!!e.chips,"v-autocomplete--selecting-index":o.value>-1,[`v-autocomplete--${e.multiple?"multiple":"single"}`]:!0,"v-autocomplete--selection-slot":!!t.selection},e.class],style:e.style,appendInnerIcon:e.menuIcon,readonly:e.readonly,placeholder:c?void 0:e.placeholder,"onClick:clear":le,"onMousedown:control":te,onKeydown:ae}),{...t,default:()=>s(J,null,[s(Le,I({ref:S,modelValue:f.value,"onUpdate:modelValue":n=>f.value=n,activator:"parent",contentClass:"v-autocomplete__content",eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterLeave:ue},e.menuProps),{default:()=>[a&&s(he,{ref:E,selected:$.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:n=>n.preventDefault(),onFocusin:oe,onFocusout:se},{default:()=>{var n,m,C;return[!L.value.length&&!e.hideNoData&&(((n=t["no-data"])==null?void 0:n.call(t))??s(U,{title:h(e.noDataText)},null)),(m=t["prepend-item"])==null?void 0:m.call(t),L.value.map(u=>{var A;return((A=t.item)==null?void 0:A.call(t,{item:u,props:I(u.props,{onClick:()=>x(u)})}))??s(U,I({key:u.value},u.props,{onClick:()=>x(u)}),{prepend:p=>{let{isSelected:D}=p;return e.multiple&&!e.hideSelected?s($e,{modelValue:D,ripple:!1,tabindex:"-1"},null):void 0},title:()=>{var p,D;return d.value?u.title:Be(u.title,(p=ee(u))==null?void 0:p.title,((D=r.value)==null?void 0:D.length)??0)}})}),(C=t["append-item"])==null?void 0:C.call(t)]}})]}),V.value.map((n,m)=>{var A;function C(p){p.stopPropagation(),p.preventDefault(),x(n)}const u={"onClick:close":C,modelValue:!0,"onUpdate:modelValue":void 0};return s("div",{key:n.value,class:["v-autocomplete__selection",m===o.value&&["v-autocomplete__selection--selected",Y.value]],style:m===o.value?Z.value:{}},[l?t.chip?s(be,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:n.title}}},{default:()=>{var p;return[(p=t.chip)==null?void 0:p.call(t,{item:n,index:m,props:u})]}}):s(Ee,I({key:"chip",closable:e.closableChips,size:"small",text:n.title},u),null):((A=t.selection)==null?void 0:A.call(t,{item:n,index:m}))??s("span",{class:"v-autocomplete__selection-text"},[n.title,e.multiple&&m<V.value.length-1&&s("span",{class:"v-autocomplete__selection-comma"},[we(",")])])])})])})}),ve({isFocused:k,isPristine:d,menu:f,search:r,filteredItems:M,select:x},v)}}),Ue=xe({name:"AppAutocomplete",inheritAttrs:!1}),Ye=Object.assign(Ue,{setup(e){const i=y(()=>{const h=K(),v=h.id||h.label;return v?`app-autocomplete-${v}-${Math.random().toString(36).slice(2,7)}`:void 0}),t=y(()=>K().label);return(h,v)=>(j(),Ae("div",{class:Te(["app-autocomplete flex-grow-1",h.$attrs.class])},[F(t)?(j(),Ie(ie,{key:0,for:F(i),class:"mb-1 text-body-2 text-high-emphasis",text:F(t)},null,8,["for","text"])):Se("",!0),s(Ne,q(H({...h.$attrs,class:null,label:void 0,id:F(i),variant:"outlined",menuProps:{contentClass:["app-inner-list","app-autocomplete__content","v-autocomplete__content"]}})),Pe({_:2},[De(h.$slots,(k,d)=>({name:d,fn:Fe(S=>[Re(h.$slots,d,q(H(S||{})))])}))]),1040)],2))}});export{Ne as V,Ye as _};
